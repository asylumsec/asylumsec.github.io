
<!DOCTYPE html>
<!--[if IE 9]><html lang="en-us" class="ie9"><![endif]-->
<!--[if gt IE 9]><!-->
<html lang="en-us" class="layout-pf layout-pf-fixed">
<!--<![endif]-->
  <head>
    <title>Fort Nebula Latest | Openstack | Triple-O | Swift ISCSI</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/assets/dist/img/favicon.ico">
    <!-- iPad retina icon -->
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../dist/img/apple-touch-icon-precomposed-152.png">
    <!-- iPad retina icon (iOS < 7) -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../dist/img/apple-touch-icon-precomposed-144.png">
    <!-- iPad non-retina icon -->
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../../dist/img/apple-touch-icon-precomposed-76.png">
    <!-- iPad non-retina icon (iOS < 7) -->
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../dist/img/apple-touch-icon-precomposed-72.png">
    <!-- iPhone 6 Plus icon -->
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../dist/img/apple-touch-icon-precomposed-180.png">
    <!-- iPhone retina icon (iOS < 7) -->
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../dist/img/apple-touch-icon-precomposed-114.png">
    <!-- iPhone non-retina icon (iOS < 7) -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../../dist/img/apple-touch-icon-precomposed-57.png">
    <link rel="stylesheet" href="/assets/dist/css/asciibinder.css" >
    <link rel="stylesheet" href="/assets/dist/css/docs.css" >
    <link rel="stylesheet" href="/assets/dist/css/patternfly.min.css" >
    <link rel="stylesheet" href="/assets/dist/css/patternfly-additions.min.css" >

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js" type="text/javascript"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.matchHeight/0.7.0/jquery.matchHeight-min.js" type="text/javascript"></script>
    <script src="/assets/dist/js/patternfly.min.js" type="text/javascript"></script>
    <script src="/assets/dist/js/bootstrap-offcanvas.js" type="text/javascript"></script>
  </head>

  <nav class="navbar navbar-pf-vertical">
  <div class="navbar-header">
     <button type="button" class="navbar-toggle">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a href="/" class="navbar-brand">
      <img class="navbar-brand-icon" src="/assets/dist/img/logo-alt.svg" alt=""/><img class="navbar-brand-name" src="/assets/dist/img/fn-brand.svg" alt="PatternFly Enterprise Application" />
    </a>
  </div>
  <nav class="collapse navbar-collapse">
    <ul class="nav navbar-nav">
    </ul>
    <ul class="nav navbar-nav navbar-right navbar-iconic">
      <li class="dropdown">
        <a class="dropdown-toggle nav-item-iconic" id="notifications" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
          <span title="Notifications" class="fa pficon-flag"></span>
          <span class="badge">0</span>
        </a>
        <div class="dropdown-menu infotip bottom-right">
          <div class="arrow"></div>
          <ul class="list-group">
            <li class="list-group-item">
              <span class="i pficon pficon-info"></span> No Messages
            </li>
          </ul>
        </div>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle nav-item-iconic" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
          <span title="Help" class="fa pficon-help"></span>
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
          <li><a href="https://github.com/donnydavis/donnydavis.github.io">Fork Me</a></li>
          <li><a href="/about">About</a></li>
        </ul>
      </li>
    </ul>
  </nav>
</nav> <!--/.navbar-->


<div class="nav-pf-vertical">
  <ul class="list-group">
    <li class="list-group-item">
      <a href="/#">
        <span class="fa fa-dashboard" data-toggle="tooltip" title="Home"></span>
        <span class="list-group-item-value">Home</span>
      </a>
    </li>
    <li class="list-group-item">
      <a href="/articles">
        <span class="fa fa-paper-plane" data-toggle="tooltip" title="Articles"></span>
        <span class="list-group-item-value">Articles</span>
      </a>
    </li>
    <li class="list-group-item">
      <a href="/services">
        <span class="fa fa-rocket" data-toggle="tooltip" title="Services"></span>
        <span class="list-group-item-value">Services</span>
      </a>
    </li>
    <li class="list-group-item">
      <a href="/about">
        <span class="fa fa-graduation-cap" data-toggle="tooltip" title="About"></span>
        <span class="list-group-item-value">About</span>
      </a>
    </li>
    <li class="list-group-item">
      <a href="/links">
        <span class="fa fa-link" data-toggle="tooltip" title="Links"></span>
        <span class="list-group-item-value">Links</span>
      </a>
    </li>
    <li class="list-group-item">
      <a href="/docs/latest/welcome/">
        <span class="fa fa-book" data-toggle="tooltip" title="Links"></span>
        <span class="list-group-item-value">Docs</span>
      </a>
    </li>
  </ul>
</div>

<script>
  $(document).ready(function() {
    // matchHeight the contents of each .card-pf and then the .card-pf itself
    $(".row-cards-pf > [class*='col'] > .card-pf .card-pf-title").matchHeight();
    $(".row-cards-pf > [class*='col'] > .card-pf > .card-pf-body").matchHeight();
    $(".row-cards-pf > [class*='col'] > .card-pf > .card-pf-footer").matchHeight();
    $(".row-cards-pf > [class*='col'] > .card-pf").matchHeight();

    // Initialize the vertical navigation
    $().setupVerticalNavigation(true);
  });
</script>

  <body>
<div class="container-fluid container-cards-pf container-pf-nav-pf-vertical">
<div class="container-fluid">
  <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
  </p>
     <ol class="breadcrumb">
       <li class="hidden-xs active">
         <a href="../../welcome/index.html">Fort Nebula Latest</a>
       </li>
       <li class="hidden-xs active">
         <a href="../../openstack/index.html">Openstack</a>
       </li>
       <li class="hidden-xs active"><a href="../../openstack/tripleo/index.html">Triple-O</a></li>
       <li class="hidden-xs active">
         Swift ISCSI
       </li>
     </ol>
     <div class="row row-offcanvas row-offcanvas-left">
       <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
         <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-right"></span>Welcome
      </a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../../welcome/index.html">Welcome</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup1">
        <span id="tgSpan1" class="fa fa-angle-down"></span>Openstack
      </a>
      <ul id="topicGroup1" class="collapse in list-unstyled">
            <li><a class="" href="../../openstack/index.html">Get Started</a></li>
            <li class="nav-header">
              <a class="" href="#" data-toggle="collapse" data-target="#topicSubGroup-1-1">
                <span id="sgSpan-1-1" class="fa fa-caret-down"></span>&nbsp;Triple-O
              </a>
              <ul id="topicSubGroup-1-1" class="nav-tertiary list-unstyled collapse in">
                  <li><a class="" href="../../openstack/tripleo/index.html">What is Triple-O</a></li>
                  <li><a class="" href="../../openstack/tripleo/keystone.html">Keystone Domains</a></li>
                  <li><a class=" active" href="../../openstack/tripleo/swift-iscsi.html">Swift ISCSI</a></li>
              </ul>
            </li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup2">
        <span id="tgSpan2" class="fa fa-angle-right"></span>Openshift
      </a>
      <ul id="topicGroup2" class="collapse  list-unstyled">
            <li><a class="" href="../../openshift/index.html">Get Started</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup3">
        <span id="tgSpan3" class="fa fa-angle-right"></span>FreeIPA
      </a>
      <ul id="topicGroup3" class="collapse  list-unstyled">
            <li><a class="" href="../../ipa/index.html">Get Started</a></li>
            <li><a class="" href="../../ipa/bind.html">Adding a bind user</a></li>
      </ul>
    </li>
</ul>
       </div>
       <div class="col-xs-12 col-sm-9 col-md-9 main">
         <div class="page-header">
           <h2>Triple-O Swift ISCSI</h2>
         </div>
	 <div class="col-xs-12 col-sm-6 col-md-8">
           <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#overview">Overview</a>
<ul class="sectlevel2">
<li><a href="#modifications-preconfig">Adding support to mount iscsi drives</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For my enviroment I wanted to be able to use a single multi-purpose storage server, but I didn&#8217;t want to lose functionality.</p>
</div>
<div class="paragraph">
<p>The setup for this is to support 3 controller nodes, so I created three targets on my SAN. The target ends with the hostname of the controller node, IE overcloud-controller-0 etc</p>
</div>
<div class="sect2">
<h3 id="modifications-preconfig"><a class="anchor" href="#modifications-preconfig"></a>Adding support to mount iscsi drives</h3>
<div class="paragraph">
<p>The purpose of this is to show how you can easily customize your Openstack deployment to suit your enviroment. The following will mount an iscsi drive on each controller node in the pre-config phase of deployment</p>
</div>
<div class="paragraph">
<p>First you need to add in support for pre-config of the controller node.</p>
</div>
<div class="paragraph">
<p>This file is called controller-pre-deploy.yaml</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">resource_registry:
  OS::TripleO::ControllerExtraConfigPre: extraconfig/pre_deploy/controller/controller-extra-config-pre-deploy.yaml <i class="conum" data-value="1"></i><b>(1)</b>
parameter_defaults:
  SwiftRawDisks: {"sdb": {}} <i class="conum" data-value="2"></i><b>(2)</b>
  SwiftReplicas: 1 <i class="conum" data-value="3"></i><b>(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Please note the directory, and ensure the file that is being loaded actually exists.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Change this value to meet what disk your lun gets mounted as. If you only have one disk, its more than likely sdb</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The SAN is taking care of replicating the data, no sense in replicating it 3 more times.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>Next we add the directory and create the file to be loaded.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">mkdir -p extraconfig/pre_deploy/controller/
touch extraconfig/pre_deploy/controller/controller-extra-config-pre-deploy.yaml</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can open this file up in your favorite editor and insert the following.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">heat_template_version: 2014-10-16

description: &gt;
  Mount iSCSI Drives to Controller Nodes, Create domains file for keystone

# Note extra parameters can be defined, then passed data via the
# environment parameter_defaults, without modifying the parent template
parameters:
  server:
    type: string

resources:
  AttachIscsiDrive:
    type: OS::Heat::SoftwareConfig
    properties:
      group: script
      config: |
        #!/bin/sh
        export _HOSTNAME=$(hostname -s) <i class="conum" data-value="1"></i><b>(1)</b>
        /sbin/iscsiadm -m discovery -t sendtargets -p 192.168.254.235 <i class="conum" data-value="2"></i><b>(2)</b>
        /sbin/iscsiadm -m node -T iqn.2010-01.org.example.hostname:$_HOSTNAME --login <i class="conum" data-value="3"></i><b>(3)</b>

  AttachIscsiDriveDeployment:
    type: OS::Heat::SoftwareDeployment
    properties:
      name: AttachIscsiDriveDeployment
      config: {get_resource: AttachIscsiDrive}
      actions: ['CREATE'] # Only do this on CREATE
      server: {get_param: server}

  WipeIscsiDisks:
    type: OS::Heat::SoftwareConfig
    properties:
      group: script
      config: |
        #!/bin/sh
        /usr/bin/dd if=/dev/zero of=/dev/sdb bs=128K count=100

  WipeIscsiDiskDeployment:
    type: OS::Heat::SoftwareDeployment
    properties:
      name: WipeIscsiDiskDeployment
      server: {get_param: server}
      config: {get_resource: WipeIscsiDisks}
      actions: ['DELETE'] # Only do this on DELETE

outputs:
  deploy_stderr:
   description: Captured stderr from the configuration execution
   value: {get_attr: [AttachIscsiDriveDeployment, deploy_stderr]}
  deploy_stdout:
    description: Captured stdout from the configuration execution
    value: {get_attr: [AttachIscsiDriveDeployment, deploy_stdout]}</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>What this does is get a unique name from each controller, so they can mount different targets</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Don&#8217;t forget to change the IP to meet your enviroment</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The target name is broken into two pieces. First the target server portal name iqn.2010-01.org.example.hostname and then our unique hostname variable created in 1</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>Enjoy</p>
</div>
</div>
</div>
</div>
	  </div>
       </div>
     </div>
  </div>
<script>
  $(function() {
    // matchHeight the contents of each .card-pf and then the .card-pf itself
    $(".row-cards-pf > [class*='col'] > .card-pf > .card-pf-body").matchHeight();
  });
  $(document).ready(function() {
    // Card Single Select
    $('.card-pf-view-single-select').click(function() {
      if ($(this).hasClass('active'))
      { $(this).removeClass('active'); }
      else
      { $('.card-pf-view-single-select').removeClass('active'); $(this).addClass('active'); }
    });
  });
</script>

</div>
<script type="text/javascript">
 /*<![CDATA[*/
 $(document).ready(function() {
   $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
     if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
       $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
     }
   });
   $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
     if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
       $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
     }
   });
   $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
     $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
   });
   $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
     $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
   });
 });
 /*]]>*/
</script>
  </body>
</html>